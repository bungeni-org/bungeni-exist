<div xmlns="http://www.w3.org/1999/xhtml" id="content"><page:info xmlns:page="http://bungeni.org/page"><page:title>Home</page:title></page:info><div class="yui-content"><div id="title-search"> 
   <!-- BeginRenderedBy(titlesearch:get-title-search()) --><label for="ititlesearch" id="for-ititlesearch">Search by Act Title</label><input id="ititlesearch" type="text"/><input id="ititlesearchactid" type="hidden"/>
   <!-- the results appear here --><div id="title-search-container"/></div><script type="text/javascript">
    /** BeginRenderedBy(titlesearch:get-title-search-scripts()) ****/   
	var title_ds = 'http://localhost:8080/exist/apps/framework/actsjsonbyid.xql';
    YAHOO.kenyalex.bungeni.TitlesDS = new YAHOO.util.XHRDataSource(title_ds);
    YAHOO.kenyalex.bungeni.TitlesDS.responseType = YAHOO.util.XHRDataSource.TYPE_JSON;
    YAHOO.kenyalex.bungeni.TitlesDS.responseSchema = {
        resultsList : "doc",
        fields: [
            {key: "['docTitle']['#text']"},
            {key: "['docNumber']['#text']"}
        ]
    };
   YAHOO.kenyalex.bungeni.TitlesAC = new YAHOO.widget.AutoComplete("ititlesearch","title-search-container", YAHOO.kenyalex.bungeni.TitlesDS);
   YAHOO.kenyalex.bungeni.TitlesAC.allowBrowserAutocomplete = false;  
   YAHOO.kenyalex.bungeni.TitlesAC.forceSelection = true; 
   YAHOO.kenyalex.bungeni.TitlesAC.typeAhead = true;
   YAHOO.kenyalex.bungeni.TitlesAC.autoHighlight=true;
   YAHOO.kenyalex.bungeni.TitlesAC.applyLocalFilter = true;
   /** invoke autocomplete only after first 2 letters have been typed **/
   YAHOO.kenyalex.bungeni.TitlesAC.minQueryLength = 3;

   
   YAHOO.kenyalex.bungeni.TitlesAC.itemSelectEvent.subscribe(function(sType, sArgs) {
        var titleSearch = sArgs[2];
        var actTitle = titleSearch[0]; 
        var actId = titleSearch[1];
        YAHOO.util.Dom.get("ititlesearchactid").value = actId;
        /** we have to make a request to retrive the act based on these parameters  **/
        /** use the eXist MVC rewrite proxy **/
        searchByTitle(actId);
   });
   
    
   
    function searchByTitle(actId) {
          var params = 'actid=' + escapeQuery(actId);
          //salert(params);
        var callback = {
            success: searchByTitleResponse,
            failure: requestFailed
        };
        YAHOO.util.Connect.asyncRequest('POST', 'searchbytitle', callback, params);
      }

    function requestFailed(request) {
        document.getElementById('title-search-results').innerHTML =
            "The request to the server failed.";
    }
    
    
    function searchByTitleResponse(request) {
        var xml = request.responseXML;
        if (!xml) {
            return;
        }
        var txt = request.responseText;
        //show and hide the required module objects -- these are initialized in onDomReady -- see custom.xqm
        //show the preview
        YAHOO.kenyalex.bungeni.titlesearchresults.setBody(txt);
        YAHOO.kenyalex.bungeni.titlesearchresults.show();
        //hide the act viewer
        YAHOO.kenyalex.bungeni.actviewer.hide();
        //show the button panel
        YAHOO.kenyalex.bungeni.actbuttonpanel.show()
    }
 
 /** EndRenderedBy(titlesearch:get-title-search-scripts()) ****/      
</script></div></div>